:imagesdir: Images
:figure-caption: Рисунок
:table-caption: Таблица
:toc:
:toc-title: ОГЛАВЛЕНИЕ:
== Лабораторная работа 6



=== Задание:
* Написать программу, которая по нажатию на *User Button* зажигает все (4) светодиоды, по следующему нажатию тушит все (4) светодиоды.


=== 1. Работа с платой

Необходимо, чтобы *4* светодиода, подключенных к портам *C.5, C.8, C.9, A.5*, одновременно загорались после нажатия на кнопку *User Button* и гасли при следующем нажатии, при этом нужно задать системную частоту с внешнего модуля *HSE*.

==== 1.1 Настройка частоты

* По аналогии с прошлой лабораторной работой через регистр *RCC_CR* задаем системную частоту с внешнего модуля  *HSE*.
В описании к микроконтроллеру видим что, чтобы включить HSE, необходимо перевести бит *HSEON* в единицу (рисунок 1).

.Включение генератора HSE
image::1.png[]

* Затем проверяем, что частота с нового источника стабилизировалась (рисунок 2).

.Контроль стабилизации источника
image::2.png[]

* После включения генераторов частоты, выбираем его в качестве источника для системной частоты SYSCLK. Выбор осуществляется через регистр RCC_CFGR — Clock Configuration Register (рисунок 3).

.Выбор источника частоты
image::3.png[]

==== 1.2 Настройка портов

*Алгоритм:*

* Определить какой порт нужно использовать

* Подключить нужный порт к источнику частоты через регистр RCC→AHB1ENR

* Определить нужна ли какая-то специфическая скорость для конктретного порта и если да, настроить её (через регистр GPIOx_OSPEEDR)

* Определить нужна ли подтяжка и какой тип выводов надо использовать (GPIOx_PUPDR и GPIOx_OTYPER)

* Определить какие выводы портов нужно использовать как выход, а какие как вход

* Настроить нужные вывода порта на вход или выход (через регистр GPIOE→MODER)

Сначала подключим порт А к шине тактирования через регистр *RCC_AHB1ENR*

.Подключение порта А
image::4.png[]

[source, c]
----
// Подключить порт А к шине тактирования
RCC::AHB1ENR::GPIOAEN::Enable::Set();
----

Произведем настройку 5-ой линии порта А.

* Есть несколько режимов скорости порта. В нашей работе достаточно 400 кГц, поэтому ставим по умолчанию Low speed.

.Настройка скорости порта
image::5.png[]

* Сделаем подтяжку резистора на 5 линию порта, чтобы не генерировать ложные переходы из-за наводки или шумов. Подтяжка обычно делается к 0 или к 1. Устанавливаем в бите значение 10 (Pull-down).

.Подключение подтягивающего резистора
image::6.png[]



 Через регистр MODER настраиваем порт на вход или выход. В нашем случае на выход, так как используем светодиоды.

.Настройка порта на вход или выход
image::7.png[]