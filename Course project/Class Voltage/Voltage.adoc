:imagesdir: Images
:figure-caption: Рисунок
:table-caption: Таблица
:toc:
:toc-title: ОГЛАВЛЕНИЕ:
== Class Voltage

=== 1. Структура программы в StarUML

Для того, чтобы найти напряжение, соотвествующее определенному коду, полученному с АЦП создаем класс Voltage.

Так как в работе используется линейный потенциометр, то напряжение можно рассчитать по формуле:

image::0.png[]


* Коэффициент *k* рассчитается по следующей формуле:

k = (maxVoltage - minVoltage)/(maxCode - minCode).

* Коэффициент *b* рассчитается по следующей формуле:

b = minVoltage - minCode * (maxVoltage - minVoltage)/(maxCode - minCode).

* Для рассчета этих параметров нужны значения минимального и максимального напряжения, получаемые с помощью потенциометра (их мы замерим с помощью мультиметра). А также значения минимального и максимального кода АЦП. В работе используется 12-битный АЦП, следовательно, значения minCode = 0, а maxCode = 4095.

* В методе **convertToVolt **рассчитывается текущее значение напряжения по указанной выше формуле.

* Архитектура класса Voltage показана на рисунке 1.

.Структура программы в StarUML
image::1.png[]

=== 2. Реализация класса

Код файла *voltage.h*:
[source,c]
----
#pragma once
#include <cstdint>

class Voltage
{
public:
float ConvertToVolt(uint32_t data, float k, float b)
{
float result = 0.0F;
result = static_cast<float>(k * data + b);
return result;
}
};
----

Проверим как преобразуется напряжение. Введем код например 3873.

Код файла *main.cpp*:
[source,c]
----
#include "voltage.h" //for Voltage
#include <iostream>

using namespace std;

Voltage volt;

int main()
{
const float maxVolt = 3.0F; //for maximumVoltage
const float minVolt = 0.0F; //for minimumVoltage
const uint32_t maxCode = 4095; //for maximumCode
const uint32_t minCode = 0U; //for minimumCode

const float k = (maxVolt - minVolt)/(maxCode - minCode); //for coef K
const float b = minVolt - minCode * (maxVolt - minVolt)/(maxCode - minCode); //for coef B

float u = volt.ConvertToVolt(3873, k, b);

cout << u << endl;

return 0;
}
----

Полученное напряжение:

image::2.png[]

